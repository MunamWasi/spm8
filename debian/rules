#!/usr/bin/make -f

# get octave paths (have to build-depend on octave-headers)
include /usr/share/octave/debian/defs.make

# one ring to rule them all ...
%:
	dh $@

override_dh_auto_configure:
override_dh_auto_build:
	# build manual
	cd man && pdflatex manual && bibtex manual && pdflatex manual \
		&& pdflatex manual

override_dh_auto_install:
	# create a link in octaves PATH to SPM
	-mkdir -p debian/spm8/$(MDIR)
	ln -sf /usr/share/spm8 debian/spm8/$(MDIR)/spm8
	# all files in root
	find . -maxdepth 1 -type f \
		-exec install -m 644 -t debian/spm8/usr/share/spm8 \{\} \;
	# and all directories, but a few that are shipped in other packages
	find . -maxdepth 1 -mindepth 1 -type d \
		! -name debian \
		! -name templates \
		! -name tpm \
		! -name man \
		! -name apriori \
		! -name src \
		! -name EEGtemplates \
		! -name .git \
		! -name canonical \
		-exec cp -r -t debian/spm8/usr/share/spm8 \{\} \;
	# cleanup overshoot
	find debian/spm8/usr/share/spm8 -type f -name '*.c' -delete
	find debian/spm8/usr/share/spm8 -type f -name '*.h' -delete
	find debian/spm8/usr/share/spm8 -type f -name '*.nii' -delete

override_dh_auto_test:

override_dh_clean:
	# clean after latex
	find man -name '*.aux' -delete
	find man -name 'manual.*' ! -name manual.tex -delete
	dh_clean

override_dh_compress:
	# manual comes in a separate doc package -- no need to keep compressed
	dh_compress -X.pdf
